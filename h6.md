# x) Lets encrypt - How it works -kirjoituksen muistiinpanot

- Let’s Encrypt ja ACME-protokolla mahdollistavat automaattisen HTTPS-varmenteen hankinnan ilman ihmisen väliintuloa verkkopalvelimelle.
- Varmenteen hankinnan vaiheet:
  - Palvelimen on todistettava, että se hallitsee verkkotunnusta.
  - Kun hallinta on vahvistettu, palvelin voi pyytää, uusia ja perua varmenteita automaattisesti.
- Verkkotunnuksen hallinnan todistaminen:
  - Palvelimen ylläpitäjä tunnistetaan julkisella avaimella.
  - Ensimmäisellä käyttökerralla palvelinohjelmisto (agentti) luo avainparin ja todistaa verkkotunnuksen hallinnan varmentajalle (CA).
- CA antaa haasteita, joilla palvelin voi todistaa hallinnan, esim.:
  - Lisäämällä tietyn DNS-tietueen verkkotunnukseen.
  - Luomalla tietyn tiedoston palvelimen verkkosivulle.
- Palvelin suorittaa yhden haasteista ja allekirjoittaa CA:n antaman nonce-arvon yksityisellä avaimellaan.
- CA tarkistaa haasteen suorittamisen ja myöntää palvelimelle oikeuden hallita verkkotunnuksen varmenteita.
- Sertifikaatin (varmenteen) myöntäminen:
  - Kun palvelin on valtuutettu, se voi pyytää varmenteen.
  - Palvelin lähettää varmenteen allekirjoituspyynnön (CSR) CA:lle.
  - CA tarkistaa pyynnön, myöntää varmenteen ja tallentaa sen julkisiin Certificate Transparency -lokitietoihin.
- Sertifikaatin peruminen:
  - Jos varmenne täytyy perua, palvelin lähettää allekirjoitetun perumispyynnön CA:lle.
  - CA tarkistaa pyynnön ja julkaisee peruutustiedon, jolloin selain ei enää hyväksy sertifikaattia.

---
Lähteet

https://letsencrypt.org/how-it-works/

---

# x) Using an existing, running web server -kirjoituksen muistiinpanot

- Jos palvelin käyttää jo porttia 80, Let’s Encrypt -varmenteen hankkimiseksi käytettävä --http-vaihtoehto vaatii myös --http.webroot-vaihtoehdon.
- Mitä --http.webroot tekee?
    - Se ei käynnistä uutta palvelinta, vaan yksinkertaisesti luo ja tallentaa haasteen tunnustiedoston palvelimen tiedostojärjestelmään.
    - Tämä tiedosto sisältää HTTP-01-haasteen tunnuksen, joka tallennetaan hakemistoon .well-known/acme-challenge.
- Miksi tämä hakemisto on tärkeä?
    - Hakemiston täytyy olla julkisesti saatavilla verkkotunnuksen juurena (/), jotta Let’s Encrypt -palvelin voi pyytää haasteen tiedoston ja vahvistaa palvelimen hallinnan.
    - Esimerkiksi, jos haasteen tiedosto luodaan /path/to/webroot/.well-known/acme-challenge/, se tulisi olla saavutettavissa URL-osoitteesta: http://example.com/.well-known/acme-challenge/<haasteen_tiedosto>
- Mitä tehdä, jos hakemisto ei ole julkisesti saatavilla?
    - Palvelimen täytyy uudelleenohjata tai uudelleenkirjoittaa pyynnöt tähän hakemistoon.
    - Tämä voidaan tehdä esimerkiksi verkkopalvelimen asetuksissa (Apache, Nginx, jne.) lisäämällä sääntö, joka ohjaa kaikki .well-known/acme-challenge -polun pyynnöt oikeaan hakemistoon.
- Esimerkki: Lego-työkalun käyttö varmenteen hakemiseen
    - Jos käytössä on nykyinen web-palvelin portilla 80, haasteen voi suorittaa seuraavalla komennolla: lego --accept-tos --email you@example.com --http --http.webroot /path/to/webroot --domains example.com run

---

Lähteet

https://go-acme.github.io/lego/usage/cli/obtain-a-certificate/index.html#using-an-existing-running-web-server

---

%) How to: Basic configuration example -kirjoituksen muistiinpanot



---

Lähteet

https://httpd.apache.org/docs/2.4/ssl/ssl_howto.html#configexample

---

# a) Ilmaisen TLS-sertifikaatin hankkiminen ja asentaminen Let's Encryptilta


Vaihe 1: Aloitin tehtävän kirjautumalla palvelimelle SHH:n kautta. 

<img src="shhkirjautuminen.png" width="600" />


Vaihe 2: Päivitin järjestelmän ja asensin Certbotin

<img src="cart.png" width="600" />

Asensin myös lisämoduulin Chatgbt:n suosituksesta.

<img src="lisämoduuli.png" width="600" />

Vaihe 3: Asetin DNS-tietueet osoittamaan palvelimeni IP-osoitteeseen (94.237.18.62) viime viikolla, ja nyt vain varmistin, että ne ovat edelleen oikein.

<img src="nslookup.png" width="600" />

<img src="ping.png" width="600" />

Vaihe 4: TLS-sertifikaatin asentaminen

<img src="tls.png" width="600" />

Painoin "y" kirjainta kaikissa kodissa, joissa pyydettiin y/no vastausta.

Vaihe 5: Let's Encryptin sertifikaatit ovat voimassa 90 päivää, joten laitoin sertifikaatin uudistumaan automaattisesti.

Valitsin nano editorin ja laitoin sertifikaatin usiutumaan joka päivä klo 03:00.

<img src="sudocron.png" width="600" />

<img src="renew.png" width="600" />

Tallensin tiedoston painamalla Ctrl + O ja sitten Enter.

Vaihe 6: Varmistin, että HTTPS toimii.

